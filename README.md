# Voice Transcriber Overlay

Mac用常駐型 音声認識・翻訳・オーバーレイ表示アプリケーション

## 主な機能

### 基本機能
- メニューバー常駐型アプリケーション
- 指定サウンドデバイスからの音声取得→OpenAI Whisper APIで文字起こし
- OpenAI GPT-4oを使用した高精度翻訳
- オーバーレイでのリアルタイム画面表示（カスタマイズ可）
- 設定画面（フォント/大きさ/位置/透過率/フォント種類）

### 音声認識機能
- リアルタイム音声認識とテキスト変換
- 複数のサウンドデバイス対応
- 確定文章（isFinal=true）と途中経過の文章を区別して処理

### 翻訳機能
- OpenAI GPT-4oによる自然で意図を汲み取った翻訳
- テキスト変化度の計算（レーベンシュタイン距離/編集距離）による効率的な翻訳実行判断
- 文脈を考慮した一貫性のある翻訳
- 翻訳履歴の保持と活用（最大5件）
- 性別検出機能による話者の性別に適した翻訳

### 性別検出機能
- OpenAI APIを活用した話者の性別検出
- 二段階検出システム：
  1. 代名詞ベースの基本検出（he/him/she/herなど）
  2. AI判定による高度な性別検出
- 文脈履歴を活用した精度の高い性別判定
- 性別に応じた自然な翻訳文生成

### 効率化機能
- 自動翻訳実行条件の最適化:
  - 単語数40超過かつ前回から40単語以上増加かつテキスト変化度15%以上の場合に翻訳
  - 20単語以上のテキストでも変化度30%以上で翻訳実行
  - 確定文章（isFinal=true）の場合は即時翻訳
- 翻訳回数カウントと表示
- 詳細なログ表示（翻訳タイミング、理由、性別判定など）

### UI機能
- カスタマイズ可能なオーバーレイ表示
- フォント種類・サイズ・色の変更
- 表示位置と透過度の調整
- 常に最前面表示（他のアプリの上に表示）

## セットアップ
```bash
npm install
npm run start
```

## 必要なAPIキー
- OpenAI API（GPT-4o、Whisper API用）
  - 環境変数 `OPENAI_API_KEY` に設定

## 使い方
1. アプリを起動するとメニューバーにアイコンが表示されます
2. 音声入力デバイスを選択（デフォルトはシステム設定を使用）
3. 話し始めると自動的に文字起こしと翻訳が行われます
4. 翻訳テキストがオーバーレイに表示されます
5. メニューバーから設定を変更可能

## 設定オプション
- **表示設定**：フォントサイズ、色、透明度
- **位置設定**：画面上の表示位置
- **デバイス設定**：音声入力デバイスの選択
- **翻訳設定**：翻訳言語、自動翻訳条件のカスタマイズ

## テクニカル詳細

### 性別検出のしくみ
1. 入力テキストと履歴から代名詞（he/she等）の出現回数をカウント
2. OpenAI GPT-3.5 Turboによる性別判定
3. 判定結果を翻訳プロンプトに組み込み

### テキスト変化度計算
- レーベンシュタイン距離（編集距離）を使用して前回との変化度を計算
- 変化度と単語数の条件に基づいて翻訳実行を判断

### 翻訳の最適化
- 文脈履歴を活用した一貫性のある翻訳
- 性別情報を含んだ翻訳プロンプト
- 確定文章の場合は追加の校正プロセスを実行

---

